<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫∫Áãº„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .timer {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffeb3b;
        }

        .timer.urgent {
            color: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .phase {
            font-size: 1.2em;
            font-weight: bold;
        }

        .day-count {
            font-size: 1.2em;
        }

        .login-form {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .login-form input {
            padding: 10px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            margin: 10px;
            width: 200px;
        }

        .btn {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #4caf50;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #45a049;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #da190b;
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #e68900;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .players-section, .actions-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .player-list {
            margin-top: 15px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }

        .player-item.dead {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .player-item.werewolf {
            border-left: 4px solid #f44336;
        }

        .player-item.self {
            border-left: 4px solid #4caf50;
        }

        .role-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .role-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .role-description {
            font-size: 1em;
            opacity: 0.9;
        }

        .night-actions {
            margin-top: 20px;
        }

        .action-form {
            margin-bottom: 15px;
        }

        .action-form select {
            padding: 8px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            margin-right: 10px;
            width: 150px;
        }

        .voting-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .vote-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .vote-btn {
            padding: 8px 15px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .vote-btn:hover {
            background: #1976d2;
        }

        .vote-btn.selected {
            background: #ff9800;
        }

        .chat-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(0,0,0,0.2);
        }

        .chat-message {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
        }

        .chat-message.werewolf {
            background: rgba(244,67,54,0.3);
            border-left: 3px solid #f44336;
        }

        .chat-message.system {
            background: rgba(76,175,80,0.3);
            border-left: 3px solid #4caf50;
            font-style: italic;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
        }

        .results-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .result-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        .game-over {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .winner {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .winner.villager {
            color: #4caf50;
        }

        .winner.werewolf {
            color: #f44336;
        }

        .winner.draw {
            color: #ff9800;
        }

        .player-count {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .connection-status.connected {
            background: rgba(76,175,80,0.8);
        }

        .connection-status.disconnected {
            background: rgba(244,67,54,0.8);
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: rgba(255,255,255,0.4);
        }

        .notification {
            position: fixed;
            top: 50px;
            right: 10px;
            padding: 15px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            min-width: 250px;
        }

        .notification.success {
            background: rgba(76,175,80,0.9);
        }

        .notification.error {
            background: rgba(244,67,54,0.9);
        }

        .notification.info {
            background: rgba(33,150,243,0.9);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåô ‰∫∫Áãº„Ç≤„Éº„É† üê∫</h1>
        </div>

        <div class="connection-status" id="connectionStatus">
            Êé•Á∂ö‰∏≠...
        </div>

        <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
        <div class="login-form" id="loginForm">
            <h2>„Ç≤„Éº„É†„Å´ÂèÇÂä†</h2>
            <input type="text" id="playerName" placeholder="„Éó„É¨„Ç§„É§„ÉºÂêç„ÇíÂÖ•Âäõ" maxlength="20">
            <br>
            <button class="btn btn-primary" onclick="joinGame()">ÂèÇÂä†„Åô„Çã</button>
        </div>

        <!-- „Ç≤„Éº„É†ÊÉÖÂ†± -->
        <div class="game-info hidden" id="gameInfo">
            <div class="timer" id="timer">--:--</div>
            <div class="phase" id="phase">ÂæÖÊ©ü‰∏≠</div>
            <div class="day-count" id="dayCount">Ê∫ñÂÇô‰∏≠</div>
        </div>

        <!-- „Ç≤„Éº„É†ÈñãÂßãÂâç„ÅÆÂæÖÊ©üÁîªÈù¢ -->
        <div class="waiting-room hidden" id="waitingRoom">
            <div class="players-section">
                <h3>ÂèÇÂä†ËÄÖ‰∏ÄË¶ß</h3>
                <div class="player-count" id="playerCount">0‰∫∫ÂèÇÂä†‰∏≠</div>
                <div class="player-list" id="waitingPlayerList"></div>
                <button class="btn btn-primary" onclick="startGame()">„Ç≤„Éº„É†ÈñãÂßã</button>
                <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">‚Äª4‰∫∫‰ª•‰∏ä„Åß„Ç≤„Éº„É†ÈñãÂßã„Åß„Åç„Åæ„Åô</p>
            </div>
        </div>

        <!-- „Ç≤„Éº„É†‰∏≠„ÅÆ„É°„Ç§„É≥ÁîªÈù¢ -->
        <div class="main-content hidden" id="gameContent">
            <!-- „Éó„É¨„Ç§„É§„ÉºÊÉÖÂ†± -->
            <div class="players-section">
                <h3>„Éó„É¨„Ç§„É§„ÉºÊÉÖÂ†±</h3>
                <div class="player-list" id="playerList"></div>
            </div>

            <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„ÉªÊäïÁ•®„Ç®„É™„Ç¢ -->
            <div class="actions-section">
                <!-- ÂΩπËÅ∑ÊÉÖÂ†± -->
                <div class="role-info" id="roleInfo">
                    <div class="role-name" id="roleName">ÂΩπËÅ∑Êú™Ââ≤„ÇäÂΩì„Å¶</div>
                    <div class="role-description" id="roleDescription">„Ç≤„Éº„É†ÈñãÂßã„Çí„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ</div>
                </div>

                <!-- Â§ú„ÅÆË°åÂãï -->
                <div class="night-actions hidden" id="nightActions">
                    <h4>Â§ú„ÅÆË°åÂãï</h4>
                    <div class="action-form" id="actionForm">
                        <select id="actionTarget">
                            <option value="">ÂØæË±°„ÇíÈÅ∏Êäû</option>
                        </select>
                        <button class="btn btn-primary" onclick="submitNightAction()">ÂÆüË°å</button>
                    </div>
                </div>

                <!-- ÊäïÁ•®„Ç®„É™„Ç¢ -->
                <div class="voting-section hidden" id="votingSection">
                    <h4>ÊäïÁ•®</h4>
                    <p>Âá¶Âàë„Åô„Çã‰∫∫„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
                    <div class="vote-buttons" id="voteButtons"></div>
                </div>

                <!-- ÁµêÊûúË°®Á§∫„Ç®„É™„Ç¢ -->
                <div class="results-section hidden" id="resultsSection">
                    <h4>ÁµêÊûú</h4>
                    <div id="resultsContent"></div>
                </div>
            </div>
        </div>

        <!-- „ÉÅ„É£„ÉÉ„Éà„Ç®„É™„Ç¢ -->
        <div class="chat-section hidden" id="chatSection">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchChat('general')">ÂÖ®‰Ωì„ÉÅ„É£„ÉÉ„Éà</button>
                <button class="tab-btn" id="werewolfChatTab" onclick="switchChat('werewolf')" style="display: none;">‰∫∫Áãº„ÉÅ„É£„ÉÉ„Éà</button>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ..." maxlength="200">
                <button class="btn btn-primary" onclick="sendMessage()">ÈÄÅ‰ø°</button>
            </div>
        </div>

        <!-- „Ç≤„Éº„É†ÁµÇ‰∫ÜÁîªÈù¢ -->
        <div class="game-over hidden" id="gameOver">
            <div class="winner" id="winnerText">„Ç≤„Éº„É†ÁµÇ‰∫Ü</div>
            <div id="gameOverDetails"></div>
            <button class="btn btn-primary" onclick="resetGame()">Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = io();
        let currentPlayer = null;
        let gameState = null;
        let currentChatMode = 'general';
        let selectedVoteTarget = null;

        // Socket.IOÊé•Á∂ö„Ç§„Éô„É≥„Éà
        socket.on('connect', () => {
            updateConnectionStatus(true);
        });

        socket.on('disconnect', () => {
            updateConnectionStatus(false);
        });

        // „Ç≤„Éº„É†ÂèÇÂä†
        function joinGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                showNotification('„Éó„É¨„Ç§„É§„ÉºÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            socket.emit('join-game', { name });
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        function startGame() {
            socket.emit('start-game');
        }

        // Â§ú„ÅÆË°åÂãïÈÄÅ‰ø°
        function submitNightAction() {
            const target = document.getElementById('actionTarget').value;
            if (!target) {
                showNotification('ÂØæË±°„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            let actionType = '';
            if (currentPlayer.role === 'werewolf') actionType = 'attack';
            else if (currentPlayer.role === 'seer') actionType = 'divine';
            else if (currentPlayer.role === 'knight') actionType = 'defend';

            socket.emit('night-action', { type: actionType, target });
        }

        // ÊäïÁ•®
        function vote(targetId) {
            socket.emit('vote', { targetId });
            selectedVoteTarget = targetId;
            updateVoteButtons();
        }

        // „ÉÅ„É£„ÉÉ„ÉàÈÄÅ‰ø°
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            if (currentChatMode === 'general') {
                socket.emit('chat-message', { message });
            } else if (currentChatMode === 'werewolf') {
                socket.emit('werewolf-chat', { message });
            }

            input.value = '';
        }

        // „ÉÅ„É£„ÉÉ„Éà„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        function switchChat(mode) {
            currentChatMode = mode;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // „Ç≤„Éº„É†„É™„Çª„ÉÉ„Éà
        function resetGame() {
            location.reload();
        }

        // Êé•Á∂öÁä∂ÊÖãÊõ¥Êñ∞
        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.textContent = 'Êé•Á∂öÊ∏à„Åø';
                status.className = 'connection-status connected';
            } else {
                status.textContent = 'ÂàáÊñ≠‰∏≠';
                status.className = 'connection-status disconnected';
            }
        }

        // ÈÄöÁü•Ë°®Á§∫
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        // „Çø„Ç§„Éû„ÉºÊõ¥Êñ∞
        function updateTimer(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById('timer');
            timerElement.textContent = timeString;
            
            if (seconds <= 30) {
                timerElement.classList.add('urgent');
            } else {
                timerElement.classList.remove('urgent');
            }
        }

        // „Éó„É¨„Ç§„É§„Éº„É™„Çπ„ÉàÊõ¥Êñ∞
        function updatePlayerList(players, isWaiting = false) {
            const listId = isWaiting ? 'waitingPlayerList' : 'playerList';
            const list = document.getElementById(listId);
            list.innerHTML = '';

            players.forEach(player => {
                const item = document.createElement('div');
                item.className = 'player-item';
                
                if (!player.isAlive) item.classList.add('dead');
                if (currentPlayer && player.id === currentPlayer.id) item.classList.add('self');
                if (currentPlayer && currentPlayer.role === 'werewolf' && player.role === 'werewolf' && player.id !== currentPlayer.id) {
                    item.classList.add('werewolf');
                }

                let statusText = '';
                if (!player.isAlive) {
                    statusText = ` (${player.deathReason || 'Ê≠ª‰∫°'})`;
                } else if (isWaiting) {
                    statusText = ' (ÂèÇÂä†‰∏≠)';
                }

                item.innerHTML = `
                    <span>${player.name}${statusText}</span>
                    <span>${player.id === currentPlayer?.id ? '(„ÅÇ„Å™„Åü)' : ''}</span>
                `;

                list.appendChild(item);
            });

            if (isWaiting) {
                document.getElementById('playerCount').textContent = `${players.length}‰∫∫ÂèÇÂä†‰∏≠`;
            }
        }

        // ÊäïÁ•®„Éú„Çø„É≥Êõ¥Êñ∞
        function updateVoteButtons() {
            const container = document.getElementById('voteButtons');
            container.innerHTML = '';

            if (!gameState || !gameState.players) return;

            const alivePlayers = gameState.players.filter(p => p.isAlive && p.id !== currentPlayer?.id);
            alivePlayers.forEach(player => {
                const button = document.createElement('button');
                button.className = 'vote-btn';
                button.textContent = player.name;
                button.onclick = () => vote(player.id);
                
                if (selectedVoteTarget === player.id) {
                    button.classList.add('selected');
                }

                container.appendChild(button);
            });
        }

        // Â§ú„ÅÆË°åÂãïÂØæË±°Êõ¥Êñ∞
        function updateNightActionTargets() {
            const select = document.getElementById('actionTarget');
            select.innerHTML = '<option value="">ÂØæË±°„ÇíÈÅ∏Êäû</option>';

            if (!gameState || !gameState.players || !currentPlayer) return;

            const alivePlayers = gameState.players.filter(p => p.isAlive && p.id !== currentPlayer.id);
            alivePlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.id;
                option.textContent = player.name;
                select.appendChild(option);
            });
        }

        // „ÉÅ„É£„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏ËøΩÂä†
        function addChatMessage(data, isWerewolf = false, isSystem = false) {
            const messages = document.getElementById('chatMessages');
            const message = document.createElement('div');
            message.className = 'chat-message';
            
            if (isWerewolf) message.classList.add('werewolf');
            if (isSystem) message.classList.add('system');

            const timestamp = new Date(data.timestamp || Date.now()).toLocaleTimeString();
            message.innerHTML = `
                <strong>${data.name || '„Ç∑„Çπ„ÉÜ„É†'}:</strong> ${data.message}
                <span style="float: right; opacity: 0.7; font-size: 0.8em;">${timestamp}</span>
            `;

            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;
        }

        // UIË°®Á§∫Âàá„ÇäÊõø„Åà
        function showElement(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function hideElement(id) {
            document.getElementById(id).classList.add('hidden');
        }

        // Socket.IO„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº
        socket.on('joined', (data) => {
            currentPlayer = data;
            gameState = data.gameState;
            
            hideElement('loginForm');
            showElement('gameInfo');
            showElement('waitingRoom');
            showElement('chatSection');
            
            updatePlayerList(gameState.players, true);
            showNotification('„Ç≤„Éº„É†„Å´ÂèÇÂä†„Åó„Åæ„Åó„Åü', 'success');
        });

        socket.on('join-failed', (data) => {
            showNotification(data.reason, 'error');
        });

        socket.on('player-joined', (data) => {
            gameState = data.gameState;
            updatePlayerList(gameState.players, true);
            addChatMessage({ name: '„Ç∑„Çπ„ÉÜ„É†', message: `${data.name}„Åï„Çì„ÅåÂèÇÂä†„Åó„Åæ„Åó„Åü` }, false, true);
        });

        socket.on('player-left', (data) => {
            gameState = data.gameState;
            updatePlayerList(gameState.players, gameState.gameState === 'waiting');
            addChatMessage({ name: '„Ç∑„Çπ„ÉÜ„É†', message: '„Éó„É¨„Ç§„É§„Éº„ÅåÈÄÄÂá∫„Åó„Åæ„Åó„Åü' }, false, true);
        });

        socket.on('role-assigned', (data) => {
            currentPlayer.role = data.role;
            
            document.getElementById('roleName').textContent = data.roleInfo.name;
            document.getElementById('roleDescription').textContent = data.roleInfo.description;
            
            if (data.role === 'werewolf') {
                document.getElementById('werewolfChatTab').style.display = 'block';
                if (data.werewolfInfo && data.werewolfInfo.length > 0) {
                    const werewolfNames = data.werewolfInfo.map(w => w.name).join(', ');
                    addChatMessage({ name: '„Ç∑„Çπ„ÉÜ„É†', message: `‰ª≤Èñì„ÅÆ‰∫∫Áãº: ${werewolfNames}` }, true, true);
                }
            }
            
            showNotification(`„ÅÇ„Å™„Åü„ÅÆÂΩπËÅ∑: ${data.roleInfo.name}`, 'info');
        });

        socket.on('game-started', (data) => {
            gameState = data;
            hideElement('waitingRoom');
            showElement('gameContent');
            updatePlayerList(gameState.players);
            addChatMessage({ name: '„Ç∑„Çπ„ÉÜ„É†', message: '„Ç≤„Éº„É†„ÅåÈñãÂßã„Åï„Çå„Åæ„Åó„ÅüÔºÅ' }, false, true);
        });

        socket.on('start-failed', (data) => {
            showNotification(data.reason, 'error');
        });

        socket.on('phase-changed', (data) => {
            gameState = data;
            updatePlayerList(gameState.players);
            
            // „Éï„Çß„Éº„Ç∫Ë°®Á§∫Êõ¥Êñ∞
            let phaseText = '';
            switch (gameState.gameState) {
                case 'night':
                    phaseText = 'Â§ú';
                    break;
                case 'day':
                    phaseText = 'Êòº';
                    break;
                case 'voting':
                    phaseText = 'ÊäïÁ•®';
                    break;
                case 'ended':
                    phaseText = '„Ç≤„Éº„É†ÁµÇ‰∫Ü';
                    break;
            }
            
            document.getElementById('phase').textContent = phaseText;
            document.getElementById('dayCount').textContent = `${gameState.dayCount}Êó•ÁõÆ`;
            
            // UIÂàá„ÇäÊõø„Åà
            hideElement('nightActions');
            hideElement('votingSection');
            hideElement('resultsSection');
            
            if (gameState.gameState === 'night' && currentPlayer && currentPlayer.role !== 'villager' && currentPlayer.role !== 'medium') {
                showElement('nightActions');
                updateNightActionTargets();
            } else if (gameState.gameState === 'voting') {
                showElement('votingSection');
                updateVoteButtons();
            } else if (gameState.gameState === 'ended') {
                showElement('gameOver');
                hideElement('gameContent');
                hideElement('chatSection');
                
                let winnerText = '';
                let winnerClass = '';
                if (gameState.winner === 'villager') {
                    winnerText = 'Êùë‰∫∫„ÉÅ„Éº„É†ÂãùÂà©ÔºÅ';
                    winnerClass = 'villager';
                } else if (gameState.winner === 'werewolf') {
                    winnerText = '‰∫∫Áãº„ÉÅ„Éº„É†ÂãùÂà©ÔºÅ';
                    winnerClass = 'werewolf';
                } else {
                    winnerText = 'Âºï„ÅçÂàÜ„Åë';
                    winnerClass = 'draw';
                }
                
                const winnerElement = document.getElementById('winnerText');
                winnerElement.textContent = winnerText;
                winnerElement.className = `winner ${winnerClass}`;
            }
            
            selectedVoteTarget = null;
        });

        socket.on('timer-update', (data) => {
            updateTimer(data.timeRemaining);
        });

        socket.on('action-accepted', () => {
            showNotification('Ë°åÂãï„ÇíÂèó„Åë‰ªò„Åë„Åæ„Åó„Åü', 'success');
        });

        socket.on('action-rejected', () => {
            showNotification('Ë°åÂãï„ÇíÂèó„Åë‰ªò„Åë„Çâ„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü', 'error');
        });

        socket.on('vote-accepted', () => {
            showNotification('ÊäïÁ•®„Åó„Åæ„Åó„Åü', 'success');
        });

        socket.on('vote-rejected', () => {
            showNotification('ÊäïÁ•®„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü', 'error');
        });

        socket.on('vote-update', (data) => {
            gameState = data;
            updateVoteButtons();
        });

        socket.on('chat-message', (data) => {
            addChatMessage(data);
        });

        socket.on('werewolf-chat', (data) => {
            addChatMessage(data, true);
        });

        socket.on('seer-result', (data) => {
            addChatMessage({ 
                name: '„Ç∑„Çπ„ÉÜ„É†', 
                message: `Âç†„ÅÑÁµêÊûú: ${data.target}„ÅØ${data.result}„Åß„Åó„Åü` 
            }, false, true);
        });

        socket.on('medium-result', (data) => {
            addChatMessage({ 
                name: '„Ç∑„Çπ„ÉÜ„É†', 
                message: `ÈúäËÉΩÁµêÊûú: ${data.target}„ÅØ${data.result}„Åß„Åó„Åü` 
            }, false, true);
        });

        // „Ç®„É≥„Çø„Éº„Ç≠„Éº„Åß„É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // „Éó„É¨„Ç§„É§„ÉºÂêçÂÖ•Âäõ„Åß„Ç®„É≥„Çø„Éº„Ç≠„Éº
        document.getElementById('playerName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                joinGame();
            }
        });
    </script>
</body>
</html>
