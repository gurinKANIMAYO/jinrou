<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫∫Áãº„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .timer {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffeb3b;
        }

        .phase {
            font-size: 1.2em;
            font-weight: bold;
        }

        .day-count {
            font-size: 1.2em;
        }

        .login-form {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .login-form input {
            padding: 10px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            margin: 10px;
            width: 200px;
        }

        .btn {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #4caf50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background: #e68900;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .players-section, .actions-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .player-list {
            margin-top: 15px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }

        .player-item.dead {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .player-item.werewolf {
            border-left: 4px solid #f44336;
        }

        .role-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .role-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .role-description {
            font-size: 1em;
            opacity: 0.9;
        }

        .night-actions {
            margin-top: 20px;
        }

        .action-form {
            margin-bottom: 15px;
        }

        .action-form select {
            padding: 8px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            margin-right: 10px;
            width: 150px;
        }

        .voting-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .vote-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .vote-btn {
            padding: 8px 15px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .vote-btn:hover {
            background: #1976d2;
        }

        .vote-btn.selected {
            background: #ff9800;
        }

        .chat-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(0,0,0,0.2);
        }

        .chat-message {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
        }

        .chat-message.werewolf {
            background: rgba(244,67,54,0.3);
            border-left: 3px solid #f44336;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
        }

        .results-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .result-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        .game-over {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .winner {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .winner.villager {
            color: #4caf50;
        }

        .winner.werewolf {
            color: #f44336;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üê∫ ‰∫∫Áãº„Ç≤„Éº„É† üåô</h1>
        </div>

        <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
        <div id="loginScreen" class="login-form">
            <h2>„Ç≤„Éº„É†„Å´ÂèÇÂä†</h2>
            <input type="text" id="playerName" placeholder="„ÅÇ„Å™„Åü„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ" maxlength="20">
            <br>
            <button class="btn btn-primary" onclick="joinGame()">ÂèÇÂä†</button>
        </div>

        <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
        <div id="gameScreen" class="hidden">
            <!-- „Ç≤„Éº„É†ÊÉÖÂ†± -->
            <div class="game-info">
                <div class="phase" id="gamePhase">ÂæÖÊ©ü‰∏≠...</div>
                <div class="day-count" id="dayCount">Ê∫ñÂÇô‰∏≠</div>
                <div class="timer" id="timer">--:--</div>
            </div>

            <!-- ÂΩπËÅ∑ÊÉÖÂ†± -->
            <div id="roleInfo" class="role-info hidden">
                <div class="role-name" id="roleName"></div>
                <div class="role-description" id="roleDescription"></div>
                <div id="werewolfInfo" class="hidden">
                    <strong>‰ª≤Èñì„ÅÆ‰∫∫Áãº:</strong> <span id="werewolfList"></span>
                </div>
            </div>

            <!-- „Ç≤„Éº„É†ÁµÇ‰∫Ü -->
            <div id="gameOver" class="game-over hidden">
                <div class="winner" id="winnerText"></div>
                <button class="btn btn-primary" onclick="location.reload()">Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÇíÂßã„ÇÅ„Çã</button>
            </div>

            <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div class="main-content">
                <!-- „Éó„É¨„Ç§„É§„Éº‰∏ÄË¶ß -->
                <div class="players-section">
                    <h3>„Éó„É¨„Ç§„É§„Éº‰∏ÄË¶ß</h3>
                    <div class="player-list" id="playerList"></div>
                    <button id="startGameBtn" class="btn btn-primary hidden" onclick="startGame()">„Ç≤„Éº„É†ÈñãÂßã</button>
                </div>

                <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥ -->
                <div class="actions-section">
                    <h3>„Ç¢„ÇØ„Ç∑„Éß„É≥</h3>
                    
                    <!-- Â§ú„ÅÆË°åÂãï -->
                    <div id="nightActions" class="night-actions hidden">
                        <h4>Â§ú„ÅÆË°åÂãï</h4>
                        
                        <!-- ‰∫∫Áãº„ÅÆË•≤ÊíÉ -->
                        <div id="werewolfAction" class="action-form hidden">
                            <label>Ë•≤ÊíÉÂØæË±°„ÇíÈÅ∏Êäû:</label>
                            <select id="attackTarget">
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            </select>
                            <button class="btn btn-danger" onclick="setAttackTarget()">Ë•≤ÊíÉ</button>
                        </div>

                        <!-- Âç†„ÅÑÂ∏´„ÅÆÂç†„ÅÑ -->
                        <div id="seerAction" class="action-form hidden">
                            <label>Âç†„ÅÑÂØæË±°„ÇíÈÅ∏Êäû:</label>
                            <select id="divineTarget">
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            </select>
                            <button class="btn btn-primary" onclick="setDivineTarget()">Âç†„ÅÑ</button>
                        </div>

                        <!-- Áã©‰∫∫„ÅÆË≠∑Ë°õ -->
                        <div id="knightAction" class="action-form hidden">
                            <label>Ë≠∑Ë°õÂØæË±°„ÇíÈÅ∏Êäû:</label>
                            <select id="defendTarget">
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            </select>
                            <button class="btn btn-primary" onclick="setDefendTarget()">Ë≠∑Ë°õ</button>
                        </div>
                    </div>

                    <!-- ÊäïÁ•® -->
                    <div id="votingSection" class="voting-section hidden">
                        <h4>ÊäïÁ•®</h4>
                        <p>Âá¶Âàë„Åó„Åü„ÅÑ‰∫∫„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ:</p>
                        <div class="vote-buttons" id="voteButtons"></div>
                    </div>

                    <!-- ÁµêÊûúË°®Á§∫ -->
                    <div id="resultsSection" class="results-section hidden">
                        <h4>ÁµêÊûú</h4>
                        <div id="resultsList"></div>
                    </div>
                </div>
            </div>

            <!-- „ÉÅ„É£„ÉÉ„Éà -->
            <div class="chat-section">
                <h3>„ÉÅ„É£„ÉÉ„Éà</h3>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ..." maxlength="200">
                    <button class="btn btn-primary" onclick="sendMessage()">ÈÄÅ‰ø°</button>
                    <button id="werewolfChatBtn" class="btn btn-danger hidden" onclick="toggleWerewolfChat()">‰∫∫Áãº„ÉÅ„É£„ÉÉ„Éà</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // „Ç≤„Éº„É†Áä∂ÊÖã
        let socket;
        let gameState = {};
        let currentPlayer = {};
        let isWerewolfChatMode = false;

        // ÂàùÊúüÂåñ
        function init() {
            socket = io();
            setupSocketListeners();
        }

        // Socket.IO„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        function setupSocketListeners() {
            socket.on('joined', (data) => {
                currentPlayer = data;
                showGameScreen();
                updateGameState(data.gameState);
            });

            socket.on('join-failed', (data) => {
                alert('ÂèÇÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + data.reason);
            });

            socket.on('player-joined', (data) => {
                updateGameState(data.gameState);
                addChatMessage('„Ç∑„Çπ„ÉÜ„É†', `${data.name}„ÅåÂèÇÂä†„Åó„Åæ„Åó„Åü`);
            });

            socket.on('player-left', (data) => {
                updateGameState(data.gameState);
                addChatMessage('„Ç∑„Çπ„ÉÜ„É†', '„Éó„É¨„Ç§„É§„Éº„ÅåÈÄÄÂá∫„Åó„Åæ„Åó„Åü');
            });

            socket.on('role-assigned', (data) => {
                currentPlayer.role = data.role;
                showRoleInfo(data.roleInfo);
                
                if (data.werewolfInfo && data.werewolfInfo.length > 0) {
                    showWerewolfInfo(data.werewolfInfo);
                }
            });

            socket.on('game-started', (data) => {
                updateGameState(data);
                addChatMessage('„Ç∑„Çπ„ÉÜ„É†', '„Ç≤„Éº„É†„ÅåÈñãÂßã„Åï„Çå„Åæ„Åó„ÅüÔºÅ');
            });

            socket.on('timer-update', (data) => {
                updateTimer(data.timeRemaining);
            });

            socket.on('phase-changed', (data) => {
                updateGameState(data);
                handlePhaseChange(data.gameState);
            });

            socket.on('vote-update', (data) => {
                updateGameState(data);
            });

            socket.on('chat-message', (data) => {
                addChatMessage(data.name, data.message);
            });

            socket.on('werewolf-chat', (data) => {
                addChatMessage(data.name, data.message, true);
            });

            socket.on('seer-result', (data) => {
                addResult(`Âç†„ÅÑÁµêÊûú: ${data.target}„ÅØ${data.result}„Åß„Åô`);
            });

            socket.on('medium-result', (data) => {
                addResult(`ÈúäËÉΩÁµêÊûú: ${data.target}„ÅØ${data.result}„Åß„Åó„Åü`);
            });

            socket.on('action-accepted', () => {
                addChatMessage('„Ç∑„Çπ„ÉÜ„É†', 'Ë°åÂãï„ÇíÂèó„Åë‰ªò„Åë„Åæ„Åó„Åü');
            });

            socket.on('vote-accepted', () => {
                addChatMessage('„Ç∑„Çπ„ÉÜ„É†', 'ÊäïÁ•®„ÇíÂèó„Åë‰ªò„Åë„Åæ„Åó„Åü');
            });
        }

        // „Ç≤„Éº„É†„Å´ÂèÇÂä†
        function joinGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            socket.emit('join-game', { name });
        }

        // „Ç≤„Éº„É†ÁîªÈù¢„ÇíË°®Á§∫
        function showGameScreen() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        function startGame() {
            socket.emit('start-game');
        }

        // „Ç≤„Éº„É†Áä∂ÊÖãÊõ¥Êñ∞
        function updateGameState(state) {
            gameState = state;
            updatePhaseDisplay();
            updatePlayerList();
            updateActionButtons();
            updateVotingSection();
            
            if (state.gameState === 'ended') {
                showGameOver(state.winner);
            }
        }

        // „Éï„Çß„Éº„Ç∫Ë°®Á§∫Êõ¥Êñ∞
        function updatePhaseDisplay() {
            const phaseElement = document.getElementById('gamePhase');
            const dayElement = document.getElementById('dayCount');
            
            let phaseText = '';
            switch (gameState.gameState) {
                case 'waiting':
                    phaseText = 'ÂæÖÊ©ü‰∏≠';
                    break;
                case 'night':
                    phaseText = 'Â§ú„Éï„Çß„Éº„Ç∫';
                    break;
                case 'day':
                    phaseText = 'Êòº„Éï„Çß„Éº„Ç∫';
                    break;
                case 'voting':
                    phaseText = 'ÊäïÁ•®„Éï„Çß„Éº„Ç∫';
                    break;
                case 'ended':
                    phaseText = '„Ç≤„Éº„É†ÁµÇ‰∫Ü';
                    break;
            }
            
            phaseElement.textContent = phaseText;
            dayElement.textContent = gameState.dayCount ? `${gameState.dayCount}Êó•ÁõÆ` : 'Ê∫ñÂÇô‰∏≠';
        }

        // „Éó„É¨„Ç§„É§„Éº‰∏ÄË¶ßÊõ¥Êñ∞
        function updatePlayerList() {
            const playerListElement = document.getElementById('playerList');
            const startGameBtn = document.getElementById('startGameBtn');
            
            playerListElement.innerHTML = '';
            
            gameState.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item';
                
                if (!player.isAlive) {
                    playerDiv.classList.add('dead');
                }
                
                // ‰∫∫Áãº„ÅÆÂ†¥Âêà„ÅØ‰ª≤Èñì„Å´Ë°®Á§∫
                if (currentPlayer.role === 'werewolf' && player.role === 'werewolf' && player.id !== currentPlayer.playerId) {
                    playerDiv.classList.add('werewolf');
                }
                
                let statusText = player.isAlive ? 'ÁîüÂ≠ò' : 'Ê≠ª‰∫°';
                if (!player.isAlive && player.deathReason) {
                    statusText += ` (${player.deathReason})`;
                }
                
                playerDiv.innerHTML = `
                    <span>${player.name}</span>
                    <span>${statusText}</span>
                `;
                
                playerListElement.appendChild(playerDiv);
            });
            
            // „Ç≤„Éº„É†ÈñãÂßã„Éú„Çø„É≥„ÅÆË°®Á§∫Âà∂Âæ°
            if (gameState.gameState === 'waiting' && gameState.players.length >= 4) {
                startGameBtn.classList.remove('hidden');
            } else {
                startGameBtn.classList.add('hidden');
            }
        }

        // „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥Êõ¥Êñ∞
        function updateActionButtons() {
            const nightActions = document.getElementById('nightActions');
            const werewolfAction = document.getElementById('werewolfAction');
            const seerAction = document.getElementById('seerAction');
            const knightAction = document.getElementById('knightAction');
            
            // ÂÖ®„Å¶ÈùûË°®Á§∫
            nightActions.classList.add('hidden');
            werewolfAction.classList.add('hidden');
            seerAction.classList.add('hidden');
            knightAction.classList.add('hidden');
            
            if (gameState.gameState === 'night') {
                nightActions.classList.remove('hidden');
                
                // ÂΩπËÅ∑„Å´Âøú„Åò„Å¶„Ç¢„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫
                if (currentPlayer.role === 'werewolf') {
                    werewolfAction.classList.remove('hidden');
                    updateTargetOptions('attackTarget', ['werewolf']);
                } else if (currentPlayer.role === 'seer') {
                    seerAction.classList.remove('hidden');
                    updateTargetOptions('divineTarget', []);
                } else if (currentPlayer.role === 'knight') {
                    knightAction.classList.remove('hidden');
                    updateTargetOptions('defendTarget', []);
                }
            }
        }

        // ÂØæË±°ÈÅ∏ÊäûËÇ¢Êõ¥Êñ∞
        function updateTargetOptions(selectId, excludeRoles) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
            
            gameState.players.forEach(player => {
                if (player.isAlive && player.id !== currentPlayer.playerId && !excludeRoles.includes(player.role)) {
                    const option = document.createElement('option');
                    option.value = player.id;
                    option.textContent = player.name;
                    select.appendChild(option);
                }
            });
        }

        // ÊäïÁ•®„Çª„ÇØ„Ç∑„Éß„É≥Êõ¥Êñ∞
        function updateVotingSection() {
            const votingSection = document.getElementById('votingSection');
            const voteButtons = document.getElementById('voteButtons');
            
            if (gameState.gameState === 'voting') {
                votingSection.classList.remove('hidden');
                voteButtons.innerHTML = '';
                
                gameState.players.forEach(player => {
                    if (player.isAlive && player.id !== currentPlayer.playerId) {
                        const button = document.createElement('button');
                        button.className = 'vote-btn';
                        button.textContent = player.name;
                        button.onclick = () => vote(player.id);
                        voteButtons.appendChild(button);
                    }
                });
            } else {
                votingSection.classList.add('hidden');
            }
        }

        // ÂΩπËÅ∑ÊÉÖÂ†±Ë°®Á§∫
        function showRoleInfo(roleInfo) {
            const roleInfoDiv = document.getElementById('roleInfo');
            const roleName = document.getElementById('roleName');
            const roleDescription = document.getElementById('roleDescription');
            const werewolfChatBtn = document.getElementById('werewolfChatBtn');
            
            roleName.textContent = roleInfo.name;
            roleDescription.textContent = roleInfo.description;
            roleInfoDiv.classList.remove('hidden');
            
            if (roleInfo.name === '‰∫∫Áãº') {
                werewolfChatBtn.classList.remove('hidden');
            }
        }

        // ‰∫∫ÁãºÊÉÖÂ†±Ë°®Á§∫
        function showWerewolfInfo(werewolfInfo) {
            const werewolfInfoDiv = document.getElementById('werewolfInfo');
            const werewolfList = document.getElementById('werewolfList');
            
            werewolfList.textContent = werewolfInfo.map(w => w.name).join(', ');
            werewolfInfoDiv.classList.remove('hidden');
        }

        // „Éï„Çß„Éº„Ç∫Â§âÊõ¥Âá¶ÁêÜ
        function handlePhaseChange(phase) {
            switch (phase) {
                case 'night':
                    addChatMessage('„Ç∑„Çπ„ÉÜ„É†', 'Â§ú„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇÂêÑÂΩπËÅ∑„ÅØË°åÂãï„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    break;
                case 'day':
                    addChatMessage('„Ç∑„Çπ„ÉÜ„É†', 'Êúù„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇË®éË≠∞„ÅÆÊôÇÈñì„Åß„Åô„ÄÇ');
                    break;
                case 'voting':
                    addChatMessage('„Ç∑„Çπ„ÉÜ„É†', 'ÊäïÁ•®„ÅÆÊôÇÈñì„Åß„Åô„ÄÇÂá¶Âàë„Åô„Çã‰∫∫„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    break;
            }
        }

        // Â§ú„ÅÆË°åÂãïË®≠ÂÆö
        function setAttackTarget() {
            const target = document.getElementById('attackTarget').value;
            if (target) {
                socket.emit('night-action', { type: 'attack', target });
            }
        }

        function setDivineTarget() {
            const target = document.getElementById('divineTarget').value;
            if (target) {
                socket.emit('night-action', { type: 'divine', target });
            }
        }

        function setDefendTarget() {
            const target = document.getElementById('defendTarget').value;
            if (target) {
                socket.emit('night-action', { type: 'defend', target });
            }
        }

        // ÊäïÁ•®
        function vote(targetId) {
            // Ââç„ÅÆÈÅ∏Êäû„ÇíËß£Èô§
            document.querySelectorAll('.vote-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Êñ∞„Åó„ÅÑÈÅ∏Êäû„Çí„Éè„Ç§„É©„Ç§„Éà
            event.target.classList.add('selected');
            
            socket.emit('vote', { targetId });
        }

        // „ÉÅ„É£„ÉÉ„ÉàÈÄÅ‰ø°
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                if (isWerewolfChatMode) {
                    socket.emit('werewolf-chat', { message });
                } else {
                    socket.emit('chat-message', { message });
                }
                input.value = '';
            }
        }

        // ‰∫∫Áãº„ÉÅ„É£„ÉÉ„ÉàÂàá„ÇäÊõø„Åà
        function toggleWerewolfChat() {
            isWerewolfChatMode = !isWerewolfChatMode;
            const btn = document.getElementById('werewolfChatBtn');
            const input = document.getElementById('chatInput');
            
            if (isWerewolfChatMode) {
                btn.textContent = 'ÂÖ®‰Ωì„ÉÅ„É£„ÉÉ„Éà';
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-warning');
                input.placeholder = '‰∫∫Áãº„ÉÅ„É£„ÉÉ„Éà...';
            } else {
                btn.textContent = '‰∫∫Áãº„ÉÅ„É£„ÉÉ„Éà';
                btn.classList.remove('btn-warning');
                btn.classList.add('btn-danger');
                input.placeholder = '„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...';
            }
        }

        // „ÉÅ„É£„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏ËøΩÂä†
        function addChatMessage(name, message, isWerewolf = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            if (isWerewolf) {
                messageDiv.classList.add('werewolf');
            }
            
            messageDiv.innerHTML = `<strong>${name}:</strong> ${message}`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ÁµêÊûúËøΩÂä†
        function addResult(text) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsList = document.getElementById('resultsList');
            
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result-item';
            resultDiv.textContent = text;
            
            resultsList.appendChild(resultDiv);
            resultsSection.classList.remove('hidden');
        }

        // „Çø„Ç§„Éû„ÉºÊõ¥Êñ∞
        function updateTimer(seconds) {
            const timerElement = document.getElementById('timer');
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            timerElement.textContent = `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        // „Ç≤„Éº„É†ÁµÇ‰∫ÜË°®Á§∫
        function showGameOver(winner) {
            const gameOverDiv = document.getElementById('gameOver');
            const winnerText = document.getElementById('winnerText');
            
            winnerText.className = `winner ${winner}`;
            winnerText.textContent = winner === 'villager' ? 'Êùë‰∫∫Èô£Âñ∂„ÅÆÂãùÂà©ÔºÅ' : '‰∫∫ÁãºÈô£Âñ∂„ÅÆÂãùÂà©ÔºÅ';
            
            gameOverDiv.classList.remove('hidden');
        }

        // Enter„Ç≠„Éº„Åß„ÉÅ„É£„ÉÉ„ÉàÈÄÅ‰ø°
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            document.getElementById('playerName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    joinGame();
                }
            });
        });

        // ÂàùÊúüÂåñÂÆüË°å
        init();
    </script>
</body>
</html>
